<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard â€” Gizem & Tolga</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
:root {
  --cream: #faf7f2;
  --warm: #f0e8d8;
  --brown: #3d2c1e;
  --brown-light: #7a5c44;
  --accent: #c8702a;
  --accent-soft: #e8a86a;
  --green: #4a7c59;
  --red: #c0392b;
  --card: #ffffff;
  --shadow: rgba(61,44,30,0.08);
  --border: rgba(61,44,30,0.1);
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--cream);
  color: var(--brown);
  min-height: 100vh;
}

.sidebar {
  position: fixed;
  top: 0; left: 0; bottom: 0;
  width: 240px;
  background: var(--brown);
  padding: 28px 20px;
  display: flex;
  flex-direction: column;
  z-index: 50;
}

.logo {
  font-family: 'DM Serif Display', serif;
  font-size: 1.3rem;
  color: var(--cream);
  margin-bottom: 4px;
}

.logo em { color: var(--accent-soft); font-style: italic; }

.logo-sub {
  font-size: 0.7rem;
  color: rgba(250,247,242,0.4);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 36px;
}

.nav { display: flex; flex-direction: column; gap: 4px; }

.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 11px 14px;
  border-radius: 10px;
  cursor: pointer;
  color: rgba(250,247,242,0.55);
  font-size: 0.88rem;
  transition: all 0.2s;
  border: none;
  background: none;
  text-align: left;
  width: 100%;
}

.nav-item:hover { background: rgba(255,255,255,0.07); color: var(--cream); }
.nav-item.active { background: rgba(200,112,42,0.25); color: var(--accent-soft); }
.nav-icon { font-size: 1rem; width: 18px; }

.sidebar-footer {
  margin-top: auto;
  border-top: 1px solid rgba(255,255,255,0.08);
  padding-top: 16px;
  font-size: 0.72rem;
  color: rgba(250,247,242,0.3);
  text-align: center;
}

.main {
  margin-left: 240px;
  padding: 36px 36px 60px;
  min-height: 100vh;
}

.page-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 32px;
}

.page-title {
  font-family: 'DM Serif Display', serif;
  font-size: 2rem;
}

.page-subtitle { font-size: 0.85rem; color: var(--brown-light); margin-top: 4px; }

.btn-refresh {
  padding: 10px 20px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 10px;
  font-family: 'DM Sans', sans-serif;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-refresh:hover { background: #b05e20; }

/* Stats */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
  gap: 16px;
  margin-bottom: 36px;
}

.stat-card {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  border: 1px solid var(--border);
  box-shadow: 0 2px 12px var(--shadow);
  text-align: center;
}

.stat-emoji { font-size: 1.8rem; margin-bottom: 8px; }
.stat-num { font-family: 'DM Serif Display', serif; font-size: 2rem; color: var(--brown); }
.stat-label { font-size: 0.75rem; color: var(--brown-light); margin-top: 4px; }

/* QR Section */
.qr-section {
  background: var(--card);
  border-radius: 20px;
  padding: 28px;
  border: 1px solid var(--border);
  box-shadow: 0 2px 12px var(--shadow);
  margin-bottom: 36px;
  display: flex;
  align-items: center;
  gap: 28px;
  flex-wrap: wrap;
}

.qr-box {
  background: white;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid var(--border);
}

.qr-info h3 { font-family: 'DM Serif Display', serif; font-size: 1.3rem; margin-bottom: 8px; }
.qr-info p { font-size: 0.85rem; color: var(--brown-light); line-height: 1.6; margin-bottom: 12px; }

.qr-url {
  background: var(--warm);
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 0.8rem;
  color: var(--accent);
  word-break: break-all;
  margin-bottom: 12px;
}

.btn-copy {
  padding: 8px 18px;
  border: 1.5px solid var(--accent);
  color: var(--accent);
  background: transparent;
  border-radius: 8px;
  font-size: 0.82rem;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-copy:hover { background: var(--accent); color: white; }

/* Memories grid */
.section-title {
  font-family: 'DM Serif Display', serif;
  font-size: 1.4rem;
  margin-bottom: 20px;
}

.memories-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 20px;
}

.memory-card {
  background: var(--card);
  border-radius: 18px;
  overflow: hidden;
  border: 1px solid var(--border);
  box-shadow: 0 2px 12px var(--shadow);
  transition: transform 0.2s, box-shadow 0.2s;
}

.memory-card:hover { transform: translateY(-3px); box-shadow: 0 8px 24px var(--shadow); }

.memory-media {
  width: 100%;
  height: 180px;
  background: var(--warm);
  display: flex; align-items: center; justify-content: center;
  font-size: 3rem;
  overflow: hidden;
}

.memory-media img, .memory-media video {
  width: 100%; height: 100%; object-fit: cover;
}

.memory-body { padding: 16px; }

.memory-author {
  font-weight: 500;
  font-size: 0.95rem;
  margin-bottom: 4px;
}

.memory-type-badge {
  display: inline-block;
  background: var(--warm);
  border-radius: 20px;
  padding: 2px 10px;
  font-size: 0.72rem;
  color: var(--brown-light);
  margin-bottom: 8px;
}

.memory-message {
  font-size: 0.875rem;
  color: var(--brown-light);
  line-height: 1.5;
  margin-bottom: 10px;
}

.memory-time {
  font-size: 0.72rem;
  color: rgba(61,44,30,0.4);
}

.memory-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid var(--border);
}

.btn-delete {
  padding: 6px 12px;
  background: transparent;
  border: 1px solid rgba(192,57,43,0.3);
  color: var(--red);
  border-radius: 8px;
  font-size: 0.78rem;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-delete:hover { background: var(--red); color: white; border-color: var(--red); }

.empty-state {
  text-align: center;
  padding: 80px 20px;
  color: var(--brown-light);
}

.empty-state-emoji { font-size: 4rem; margin-bottom: 16px; }
.empty-state-title { font-family: 'DM Serif Display', serif; font-size: 1.5rem; margin-bottom: 8px; }

/* Sections */
.section { display: none; }
.section.active { display: block; }

.loading {
  text-align: center;
  padding: 60px;
  color: var(--brown-light);
  font-size: 1.5rem;
}

@media (max-width: 768px) {
  .sidebar { display: none; }
  .main { margin-left: 0; padding: 20px; }
}
</style>
</head>
<body>

<div class="sidebar">
  <div class="logo"><em>Gizem</em> & Tolga</div>
  <div class="logo-sub">16 MayÄ±s 2026</div>

  <nav class="nav">
    <button class="nav-item active" onclick="showSection('overview')">
      <span class="nav-icon">ğŸ“Š</span> Genel BakÄ±ÅŸ
    </button>
    <button class="nav-item" onclick="showSection('memories')">
      <span class="nav-icon">ğŸ–¼ï¸</span> TÃ¼m AnÄ±lar
    </button>
    <button class="nav-item" onclick="showSection('photos')">
      <span class="nav-icon">ğŸ“·</span> FotoÄŸraflar
    </button>
    <button class="nav-item" onclick="showSection('videos')">
      <span class="nav-icon">ğŸ¬</span> Videolar
    </button>
    <button class="nav-item" onclick="showSection('messages')">
      <span class="nav-icon">ğŸ’¬</span> Mesajlar
    </button>
    <button class="nav-item" onclick="showSection('qr')">
      <span class="nav-icon">ğŸ“±</span> QR Kod
    </button>
  </nav>

  <div class="sidebar-footer">AnÄ±lar Buluta ğŸ’</div>
</div>

<div class="main">

  <!-- OVERVIEW -->
  <div class="section active" id="section-overview">
    <div class="page-header">
      <div>
        <div class="page-title">ğŸ’ Gizem & Tolga</div>
        <div class="page-subtitle">16 MayÄ±s 2026 â€” DÃ¼ÄŸÃ¼n AnÄ±larÄ±</div>
      </div>
      <button class="btn-refresh" onclick="loadAll()">ğŸ”„ Yenile</button>
    </div>

    <div class="stats-grid" id="statsGrid">
      <div class="stat-card"><div class="stat-emoji">ğŸ“¦</div><div class="stat-num" id="statTotal">â€”</div><div class="stat-label">Toplam AnÄ±</div></div>
      <div class="stat-card"><div class="stat-emoji">ğŸ‘¥</div><div class="stat-num" id="statGuests">â€”</div><div class="stat-label">Misafir</div></div>
      <div class="stat-card"><div class="stat-emoji">ğŸ“·</div><div class="stat-num" id="statPhotos">â€”</div><div class="stat-label">FotoÄŸraf</div></div>
      <div class="stat-card"><div class="stat-emoji">ğŸ¬</div><div class="stat-num" id="statVideos">â€”</div><div class="stat-label">Video</div></div>
      <div class="stat-card"><div class="stat-emoji">ğŸµ</div><div class="stat-num" id="statAudios">â€”</div><div class="stat-label">Ses</div></div>
      <div class="stat-card"><div class="stat-emoji">ğŸ’¬</div><div class="stat-num" id="statMessages">â€”</div><div class="stat-label">Mesaj</div></div>
    </div>

    <div class="section-title">Son YÃ¼klenenler</div>
    <div class="memories-grid" id="recentGrid"><div class="loading">â³ YÃ¼kleniyor...</div></div>
  </div>

  <!-- ALL MEMORIES -->
  <div class="section" id="section-memories">
    <div class="page-header">
      <div>
        <div class="page-title">TÃ¼m AnÄ±lar</div>
        <div class="page-subtitle" id="memoriesCount">YÃ¼kleniyor...</div>
      </div>
      <button class="btn-refresh" onclick="loadAll()">ğŸ”„ Yenile</button>
    </div>
    <div class="memories-grid" id="allGrid"><div class="loading">â³ YÃ¼kleniyor...</div></div>
  </div>

  <!-- PHOTOS -->
  <div class="section" id="section-photos">
    <div class="page-header">
      <div><div class="page-title">ğŸ“· FotoÄŸraflar</div></div>
      <button class="btn-refresh" onclick="loadAll()">ğŸ”„ Yenile</button>
    </div>
    <div class="memories-grid" id="photosGrid"><div class="loading">â³ YÃ¼kleniyor...</div></div>
  </div>

  <!-- VIDEOS -->
  <div class="section" id="section-videos">
    <div class="page-header">
      <div><div class="page-title">ğŸ¬ Videolar</div></div>
      <button class="btn-refresh" onclick="loadAll()">ğŸ”„ Yenile</button>
    </div>
    <div class="memories-grid" id="videosGrid"><div class="loading">â³ YÃ¼kleniyor...</div></div>
  </div>

  <!-- MESSAGES -->
  <div class="section" id="section-messages">
    <div class="page-header">
      <div><div class="page-title">ğŸ’¬ Mesajlar</div></div>
      <button class="btn-refresh" onclick="loadAll()">ğŸ”„ Yenile</button>
    </div>
    <div class="memories-grid" id="messagesGrid"><div class="loading">â³ YÃ¼kleniyor...</div></div>
  </div>

  <!-- QR -->
  <div class="section" id="section-qr">
    <div class="page-header">
      <div><div class="page-title">ğŸ“± QR Kod</div>
      <div class="page-subtitle">Misafirlere gÃ¶ster, anÄ± yÃ¼klesinler</div></div>
    </div>

    <div class="qr-section">
      <div class="qr-box" id="qrcode"></div>
      <div class="qr-info">
        <h3>Misafir YÃ¼kleme SayfasÄ±</h3>
        <p>Bu QR kodu misafirlerinizle paylaÅŸÄ±n.<br>TelefonlarÄ±yla okutarak fotoÄŸraf, video ve mesaj yÃ¼kleyebilirler.</p>
        <div class="qr-url" id="guestUrl"></div>
        <button class="btn-copy" onclick="copyUrl()">ğŸ”— Linki Kopyala</button>
      </div>
    </div>
  </div>

</div>

<script>
let allMemories = [];

const GUEST_URL = window.location.origin + '/guest.html';

// QR oluÅŸtur
document.getElementById('guestUrl').textContent = GUEST_URL;
new QRCode(document.getElementById('qrcode'), {
  text: GUEST_URL,
  width: 160,
  height: 160,
  colorDark: '#3d2c1e',
  colorLight: '#ffffff',
});

function copyUrl() {
  navigator.clipboard.writeText(GUEST_URL).then(() => {
    const btn = event.target;
    btn.textContent = 'âœ… KopyalandÄ±!';
    setTimeout(() => btn.textContent = 'ğŸ”— Linki Kopyala', 2000);
  });
}

function showSection(name) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('section-' + name).classList.add('active');
  event.currentTarget.classList.add('active');
}

async function loadAll() {
  try {
    const [memories, stats] = await Promise.all([
      fetch('/api/memories').then(r => r.json()),
      fetch('/api/stats').then(r => r.json())
    ]);

    allMemories = memories;

    // Stats gÃ¼ncelle
    document.getElementById('statTotal').textContent = stats.total;
    document.getElementById('statGuests').textContent = stats.guests;
    document.getElementById('statPhotos').textContent = stats.photos;
    document.getElementById('statVideos').textContent = stats.videos;
    document.getElementById('statAudios').textContent = stats.audios;
    document.getElementById('statMessages').textContent = stats.messages;

    // Count gÃ¼ncelle
    document.getElementById('memoriesCount').textContent = `${memories.length} anÄ± bulundu`;

    // Gridleri doldur
    renderGrid('recentGrid', memories.slice(0, 6));
    renderGrid('allGrid', memories);
    renderGrid('photosGrid', memories.filter(m => m.type === 'photo'));
    renderGrid('videosGrid', memories.filter(m => m.type === 'video'));
    renderGrid('messagesGrid', memories.filter(m => m.type === 'message' || m.type === 'audio'));

  } catch (err) {
    console.error('YÃ¼kleme hatasÄ±:', err);
  }
}

function renderGrid(gridId, memories) {
  const grid = document.getElementById(gridId);
  if (memories.length === 0) {
    grid.innerHTML = `<div class="empty-state" style="grid-column:1/-1">
      <div class="empty-state-emoji">ğŸ“­</div>
      <div class="empty-state-title">HenÃ¼z anÄ± yok</div>
      <p style="font-size:0.85rem;color:var(--brown-light)">Misafirler QR kodu okutunca burada gÃ¶rÃ¼necek</p>
    </div>`;
    return;
  }

  const typeLabels = { photo: 'ğŸ“· FotoÄŸraf', video: 'ğŸ¬ Video', audio: 'ğŸµ Ses', message: 'ğŸ’¬ Mesaj' };
  const typeIcons = { photo: 'ğŸ“·', video: 'ğŸ¬', audio: 'ğŸµ', message: 'ğŸ’¬' };

  grid.innerHTML = memories.map(m => {
    let mediaHtml = '';
    if (m.type === 'photo' && m.files && m.files[0]) {
      mediaHtml = `<div class="memory-media"><img src="${m.files[0].url}" loading="lazy" /></div>`;
    } else if (m.type === 'video' && m.files && m.files[0]) {
      mediaHtml = `<div class="memory-media"><video src="${m.files[0].url}" controls></video></div>`;
    } else if (m.type === 'audio' && m.files && m.files[0]) {
      mediaHtml = `<div class="memory-media" style="flex-direction:column;gap:8px;font-size:2rem;">ğŸµ<audio src="${m.files[0].url}" controls style="width:80%;"></audio></div>`;
    } else {
      mediaHtml = `<div class="memory-media">${typeIcons[m.type] || 'ğŸ’¬'}</div>`;
    }

    const date = new Date(m.time).toLocaleString('tr-TR', {day:'numeric',month:'long',hour:'2-digit',minute:'2-digit'});

    return `<div class="memory-card">
      ${mediaHtml}
      <div class="memory-body">
        <div class="memory-author">${m.author}</div>
        <div class="memory-type-badge">${typeLabels[m.type] || m.type}</div>
        ${m.message ? `<div class="memory-message">${m.message}</div>` : ''}
        <div class="memory-footer">
          <span class="memory-time">${date}</span>
          <button class="btn-delete" onclick="deleteMemory('${m.id}')">ğŸ—‘ Sil</button>
        </div>
      </div>
    </div>`;
  }).join('');
}

async function deleteMemory(id) {
  if (!confirm('Bu anÄ±yÄ± silmek istediÄŸinizden emin misiniz?')) return;
  try {
    await fetch('/api/memories/' + id, { method: 'DELETE' });
    loadAll();
  } catch (err) {
    alert('Silme iÅŸlemi baÅŸarÄ±sÄ±z.');
  }
}

// Sayfa aÃ§Ä±lÄ±nca yÃ¼kle
loadAll();
// Her 30 saniyede otomatik yenile
setInterval(loadAll, 30000);
</script>
</body>
</html>
